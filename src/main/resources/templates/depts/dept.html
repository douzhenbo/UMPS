<!DOCTYPE html>
<html lang="en" xml:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="/layui/css/layui.css">
  <link rel="stylesheet" href="/css/custom.form.css">
</head>


<body>

  <div class="dept-table">
    <table class="layui-table" id="deptTable" lay-filter="deptTable" ></table>
  </div>

</body>

<script src="/layui/layui.js"></script>
<script src="/js/core.util.js"></script>

<script>
  layui.config({
    base: '/'
  }).extend({
    treetable: 'treetable-lay/treetable'
  }).use(['treetable','jquery','form','tree','table'],function () {
    var treetable = layui.treetable;
    var tree = layui.tree;
    var form = layui.form;
    var table = layui.table;
    var $ = layui.jquery;
    /*树选中节点记录*/
    var selectNode = null;
    var loadDeptTreeTable = function () {
      CoreUtil.sendAjax("/dept/getDeptList", null, function (res) {
        renderTable(res.data);
      }, "GET", false, function (res) {
        //无权限访问部门限列表提示
        layer.msg("抱歉！您暂无获取部门列表的权限");
        var noAuthorityData = [];
        renderTable(noAuthorityData);
      });
    }
    loadDeptTreeTable();
    /*初始化部门列表数据*/
    var renderTable = function (data) {
      treetable.render({
        // 渲染表格
        data: data,
        treeColIndex: 1, // 树形图标显示在第几列
        treeSpid: 0, // 最上级的父级id
        treeIdName: 'id', // id字段的名称
        treePidName: 'pid', // pid字段的名称
        treeDefaultClose: false, // 是否默认折叠
        treeLinkage: true, // 父级展开时是否自动展开所有子级
        elem: '#deptTable', // 表格id
        page: false, // 树形表格一般是没有分页的
        toolbar: '#toolbar',
        cols: [
          [
            {type: 'numbers'},
            {field: 'id', title: 'ID'},
            {field: 'deptNo', title: '部门编码'},
            {field: 'name', title: '部门名称',},
            {
              field: 'pidName', title: '上级部门名称', templet: function (item) {
                if (item.pidName === null || item.pidName === undefined) {
                  return "最顶级部门";
                } else {
                  return item.pidName;
                }
              }
            },
            {field: 'relationCode', title: '层级关系编码'},
            {field: 'managerName', title: '部门经理'},
            {field: 'phone', title: '部门经理联系电话'},
            {
              field: 'status', title: '状态', templet: function (item) {
                if (item.status === 1) {
                  return '  <input type="checkbox" lay-skin="switch" lay-text="启用|禁用" checked disabled>';
                }
                if (item.status === 0) {
                  return '  <input type="checkbox" lay-skin="switch" lay-text="启用|禁用" disabled>';
                }
              }
            },
            {
              field: 'createTime', title: '创建时间', minWidth: 120, templet: function (item) {
                return CoreUtil.formattime(item.createTime);
              }
            },
            {title: '操作', width: 250, toolbar: '#tool'}
          ]
        ]
      });
    };


  });
</script>
</html>
